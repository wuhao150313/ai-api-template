


```markdown
# æ ¡å›­æ™ºèƒ½åŠ©æ‰‹ç¼–ç¨‹æ–‡æ¡£

## ç›®å½•
- [ä¸€ã€é¡¹ç›®æ¦‚è¿°](#ä¸€é¡¹ç›®æ¦‚è¿°)
- [äºŒã€é¡¹ç›®ç»“æ„](#äºŒé¡¹ç›®ç»“æ„)
- [ä¸‰ã€é…ç½®æ–‡ä»¶è¯¦è§£](#ä¸‰é…ç½®æ–‡ä»¶è¯¦è§£)
- [å››ã€å·¥å…·ç±»è¯¦è§£](#å››å·¥å…·ç±»è¯¦è§£)
- [äº”ã€æ¥å£æ–‡æ¡£](#äº”æ¥å£æ–‡æ¡£)
- [å…­ã€æ•°æ®æ¨¡å‹](#å…­æ•°æ®æ¨¡å‹)
- [ä¸ƒã€ä½¿ç”¨ç¤ºä¾‹](#ä¸ƒä½¿ç”¨ç¤ºä¾‹)

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹
æ ¡å›­æ™ºèƒ½åŠ©æ‰‹æ˜¯ä¸€ä¸ªåŸºäº Spring AI Alibaba æ¡†æ¶æ„å»ºçš„æ™ºèƒ½å¯¹è¯ç³»ç»Ÿï¼Œèƒ½å¤Ÿå›ç­”å¤©æ°”é—®é¢˜ã€æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯ã€å›¾ä¹¦é¦†åº§ä½ç­‰æ ¡å›­ç›¸å…³é—®é¢˜ã€‚

### 1.2 æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Spring Boot 3.5.7
- **JDKç‰ˆæœ¬**: 17
- **AIæ¡†æ¶**: Spring AI Alibaba 1.1.0.0-M5
- **å¤§æ¨¡å‹**: é˜¿é‡Œäº‘ DashScope (qwen-max)
- **æ„å»ºå·¥å…·**: Maven
- **ä»£ç ç®€åŒ–**: Lombok

### 1.3 æ ¸å¿ƒåŠŸèƒ½
1. **å¤©æ°”æŸ¥è¯¢**: æŸ¥è¯¢æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯
2. **è¯¾ç¨‹æŸ¥è¯¢**: æ ¹æ®å­¦å·æŸ¥è¯¢å­¦ç”Ÿè¯¾ç¨‹è¡¨
3. **å›¾ä¹¦é¦†åº§ä½æŸ¥è¯¢**: æŸ¥è¯¢å›¾ä¹¦é¦†å„åŒºåŸŸçš„åº§ä½æƒ…å†µ
4. **æ ¡å›­ä¿¡æ¯æŸ¥è¯¢**: æŸ¥è¯¢å›¾ä¹¦é¦†ã€é£Ÿå ‚ã€æ•™åŠ¡å¤„ç­‰æ ¡å›­ä¿¡æ¯
5. **å¤šè½®å¯¹è¯**: æ”¯æŒä¸Šä¸‹æ–‡è®°å¿†çš„è¿ç»­å¯¹è¯

---

## äºŒã€é¡¹ç›®ç»“æ„

```
campus-assistant/
â”œâ”€â”€ pom.xml                                    # Mavené…ç½®æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â””â”€â”€ top/wuhao/assistant/
â”‚   â”‚   â”‚       â”œâ”€â”€ CampusAssistantApplication.java    # å¯åŠ¨ç±»
â”‚   â”‚   â”‚       â”œâ”€â”€ config/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ AgentConfig.java               # Agenté…ç½®ç±»
â”‚   â”‚   â”‚       â”œâ”€â”€ controller/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ AdvancedAgentController.java   # é«˜çº§Agentæ¥å£
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ SimpleAgentController.java      # ç®€å•æµ‹è¯•æ¥å£
â”‚   â”‚   â”‚       â”œâ”€â”€ model/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ RequestDTO.java                # è¯·æ±‚DTO
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ AssistantResponse.java         # å“åº”DTO
â”‚   â”‚   â”‚       â””â”€â”€ tool/
â”‚   â”‚   â”‚           â”œâ”€â”€ CampusInfoTool.java            # æ ¡å›­ä¿¡æ¯å·¥å…·
â”‚   â”‚   â”‚           â”œâ”€â”€ CourseQueryTool.java           # è¯¾ç¨‹æŸ¥è¯¢å·¥å…·
â”‚   â”‚   â”‚           â”œâ”€â”€ LibrarySeatTool.java           # å›¾ä¹¦é¦†åº§ä½å·¥å…·
â”‚   â”‚   â”‚           â””â”€â”€ WeatherTool.java               # å¤©æ°”æŸ¥è¯¢å·¥å…·
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yml                         # åº”ç”¨é…ç½®æ–‡ä»¶
â”‚   â”‚       â””â”€â”€ static/
â”‚   â”‚           â””â”€â”€ chat.html                           # å‰ç«¯æµ‹è¯•é¡µé¢
â”‚   â””â”€â”€ test/
â””â”€â”€ ç®€æ˜“æ ¡å›­æ™ºèƒ½åŠ©æ‰‹å¼€å‘æ•™ç¨‹.md
```

---

## ä¸‰ã€é…ç½®æ–‡ä»¶è¯¦è§£

### 3.1 Mavené…ç½® (pom.xml)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    
    <!-- Spring Boot çˆ¶é¡¹ç›® -->
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.5.7</version>
        <relativePath/>
    </parent>
    
    <!-- é¡¹ç›®åŸºæœ¬ä¿¡æ¯ -->
    <groupId>top.wuhao</groupId>
    <artifactId>campus-assistant</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <packaging>jar</packaging>
    <name>campus-assistant</name>
    <description>æ ¡å›­åŠ©æ‰‹</description>
    
    <!-- å±æ€§é…ç½® -->
    <properties>
        <maven.compiler.source>17</maven.compiler.source>
        <maven.compiler.target>17</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <spring-ai-alibaba.version>1.1.0.0-M5</spring-ai-alibaba.version>
    </properties>
    
    <!-- ä¾èµ–é…ç½® -->
    <dependencies>
        <!-- Spring Boot Web Starter -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <!-- Spring AI Alibaba Agent Framework -->
        <dependency>
            <groupId>com.alibaba.cloud.ai</groupId>
            <artifactId>spring-ai-alibaba-agent-framework</artifactId>
            <version>${spring-ai-alibaba.version}</version>
        </dependency>
        
        <!-- DashScope ChatModel æ”¯æŒ -->
        <dependency>
            <groupId>com.alibaba.cloud.ai</groupId>
            <artifactId>spring-ai-alibaba-starter-dashscope</artifactId>
            <version>${spring-ai-alibaba.version}</version>
        </dependency>
        
        <!-- Lombokï¼ˆç®€åŒ–ä»£ç ï¼‰ -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
        
        <!-- Spring Boot Test -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>
    
    <!-- æ„å»ºæ’ä»¶ -->
    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>
```

**å…³é”®ä¾èµ–è¯´æ˜**:
- `spring-boot-starter-web`: æä¾›WebæœåŠ¡èƒ½åŠ›
- `spring-ai-alibaba-agent-framework`: Agentæ¡†æ¶æ ¸å¿ƒ
- `spring-ai-alibaba-starter-dashscope`: DashScopeæ¨¡å‹æ”¯æŒ
- `lombok`: ç®€åŒ–Javaä»£ç 

### 3.2 åº”ç”¨é…ç½® (application.yml)

```yaml
server:
  port: 8082

spring:
  ai:
    dashscope:
      # APIå¯†é’¥ï¼Œä¼˜å…ˆä»ç¯å¢ƒå˜é‡è·å–ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼
      api-key: ${AI_DASHSCOPE_API_KEY:sk-6c729fffee9e41509d229b7dbadb6ab5}
    chat:
      options:
        model: qwen-max        # ä½¿ç”¨çš„æ¨¡å‹åç§°
        temperature: 0.7       # æ¸©åº¦å‚æ•°ï¼Œæ§åˆ¶å›ç­”çš„éšæœºæ€§
        max-tokens: 2000       # æœ€å¤§tokenæ•°
```

**é…ç½®è¯´æ˜**:
- `server.port`: æœåŠ¡ç«¯å£ï¼Œé»˜è®¤8082
- `spring.ai.dashscope.api-key`: DashScope APIå¯†é’¥ï¼Œæ”¯æŒç¯å¢ƒå˜é‡
- `spring.ai.chat.options.model`: ä½¿ç”¨çš„å¤§æ¨¡å‹ï¼Œqwen-max
- `spring.ai.chat.options.temperature`: 0-1ä¹‹é—´ï¼Œå€¼è¶Šå¤§å›ç­”è¶Šéšæœº
- `spring.ai.chat.options.max-tokens`: é™åˆ¶å›ç­”çš„æœ€å¤§é•¿åº¦

**ç¯å¢ƒå˜é‡é…ç½®**:
```bash
# Linux/macOS
export AI_DASHSCOPE_API_KEY=ä½ çš„api_key_here

# Windows
set AI_DASHSCOPE_API_KEY=ä½ çš„api_key_here
```

---

## å››ã€å·¥å…·ç±»è¯¦è§£

### 4.1 å·¥å…·ç±»ç»Ÿä¸€æ¥å£

æ‰€æœ‰å·¥å…·ç±»éƒ½å®ç° `BiFunction<String, ToolContext, T>` æ¥å£ï¼š

```java
@Component
public class XxxTool implements BiFunction<String, ToolContext, ReturnType> {
    @Override
    public ReturnType apply(
        @ToolParam(description = "å‚æ•°æè¿°") String param,
        ToolContext toolContext
    ) {
        // å·¥å…·é€»è¾‘å®ç°
    }
}
```

**å…³é”®æ³¨è§£**:
- `@Component`: æ³¨å†Œä¸ºSpring Bean
- `@ToolParam`: æè¿°å‚æ•°ï¼Œå¸®åŠ©LLMç†è§£å‚æ•°å«ä¹‰
- `ToolContext`: æä¾›å·¥å…·æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯

### 4.2 å¤©æ°”æŸ¥è¯¢å·¥å…· (WeatherTool.java)

**æ–‡ä»¶è·¯å¾„**: `src/main/java/top/wuhao/assistant/tool/WeatherTool.java`

**å®Œæ•´ä»£ç **:
```java
package top.wuhao.assistant.tool;

import org.springframework.ai.chat.model.ToolContext;
import org.springframework.ai.tool.annotation.ToolParam;
import org.springframework.stereotype.Component;
import java.util.function.BiFunction;

/**
 * @author mqxu
 * @date 2025/11/26
 * @description å¤©æ°”æŸ¥è¯¢å·¥å…·
 **/
@Component
public class WeatherTool implements BiFunction<String, ToolContext, String> {
    
    @Override
    public String apply(
            @ToolParam(description = "åŸå¸‚åç§°ï¼Œå¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å—äº¬") String city,
            ToolContext toolContext) {
        // å®é™…é¡¹ç›®ä¸­è¿™é‡Œåº”è¯¥è°ƒç”¨çœŸå®çš„å¤©æ°”API
        // è¿™é‡Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
        return String.format(
            "{ \"city\": \"%s\", \"weather\": \"æ™´å¤©\", \"temperature\": \"22Â°C\", \"advice\": \"é€‚åˆå‡ºè¡Œï¼Œå»ºè®®ç©¿é•¿è¢–\" }", 
            city
        );
    }
}
```

**åŠŸèƒ½è¯´æ˜**:
- **è¾“å…¥å‚æ•°**: åŸå¸‚åç§°ï¼ˆStringï¼‰
- **è¿”å›ç±»å‹**: JSONæ ¼å¼çš„å¤©æ°”ä¿¡æ¯ï¼ˆStringï¼‰
- **è¿”å›æ•°æ®æ ¼å¼**:
  ```json
  {
    "city": "å—äº¬",
    "weather": "æ™´å¤©",
    "temperature": "22Â°C",
    "advice": "é€‚åˆå‡ºè¡Œï¼Œå»ºè®®ç©¿é•¿è¢–"
  }
  ```
- **è§¦å‘æ¡ä»¶**: å½“ç”¨æˆ·è¯¢é—®å¤©æ°”ã€æ¸©åº¦ã€ç©¿è¡£å»ºè®®æ—¶ï¼ŒAgentä¼šè‡ªåŠ¨è°ƒç”¨æ­¤å·¥å…·
- **å½“å‰å®ç°**: è¿”å›æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…é¡¹ç›®ä¸­åº”æ¥å…¥çœŸå®å¤©æ°”API

### 4.3 è¯¾ç¨‹æŸ¥è¯¢å·¥å…· (CourseQueryTool.java)

**æ–‡ä»¶è·¯å¾„**: `src/main/java/top/wuhao/assistant/tool/CourseQueryTool.java`

**å®Œæ•´ä»£ç **:
```java
package top.wuhao.assistant.tool;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.ai.chat.model.ToolContext;
import org.springframework.ai.tool.annotation.ToolParam;
import org.springframework.stereotype.Component;

import java.util.Arrays;
import java.util.List;
import java.util.function.BiFunction;

/**
 * @author mqxu
 * @date 2025/11/26
 * @description è¯¾ç¨‹æŸ¥è¯¢å·¥å…·
 **/
@Component
public class CourseQueryTool implements BiFunction<String, ToolContext, List<CourseQueryTool.Course>> {
    
    @Override
    public List<Course> apply(
            @ToolParam(description = "å­¦ç”Ÿå­¦å·") String studentId,
            ToolContext toolContext) {
        // ç»æµ‹è¯•ï¼Œå‰ç«¯ç»™äº†å­¦å·åï¼Œä¼ åˆ°è¿™é‡Œå˜æˆäº† {"studentId":"20220001"}ï¼Œæ‰€ä»¥å°±ç®€å•å¤„ç†äº†ä¸€ä¸‹
        if (studentId.contains("20220001")) {
            return Arrays.asList(
                    new Course("Spring Boot", "08:00-09:40", "æ•™å››319"),
                    new Course("Spring AI", "13:30-15:10", "æ•™å››419"));
        }
        if (studentId.contains("20220002")) {
            return Arrays.asList(
                    new Course("Spring Boot", "08:00-09:40", "æ•™å››319"),
                    new Course("Spring AI", "13:30-15:10", "æ•™å››419"));
        }
        return List.of();
    }
    
    @Data
    @AllArgsConstructor
    @NoArgsConstructor
    public static class Course {
        private String name;      // è¯¾ç¨‹åç§°
        private String time;      // ä¸Šè¯¾æ—¶é—´
        private String location; // ä¸Šè¯¾åœ°ç‚¹
    }
}
```

**åŠŸèƒ½è¯´æ˜**:
- **è¾“å…¥å‚æ•°**: å­¦ç”Ÿå­¦å·ï¼ˆStringï¼‰ï¼Œå¯èƒ½åŒ…å«JSONæ ¼å¼ï¼Œå¦‚ `{"studentId":"20220001"}`
- **è¿”å›ç±»å‹**: è¯¾ç¨‹åˆ—è¡¨ï¼ˆ`List<Course>`ï¼‰
- **Courseå¯¹è±¡ç»“æ„**:
  ```java
  {
    "name": "Spring Boot",      // è¯¾ç¨‹åç§°
    "time": "08:00-09:40",      // ä¸Šè¯¾æ—¶é—´
    "location": "æ•™å››319"        // ä¸Šè¯¾åœ°ç‚¹
  }
  ```
- **è§¦å‘æ¡ä»¶**: å½“ç”¨æˆ·è¯¢é—®è¯¾ç¨‹ã€è¯¾è¡¨ã€ä¸Šè¯¾åœ°ç‚¹æ—¶ï¼ŒAgentä¼šè°ƒç”¨æ­¤å·¥å…·
- **æ³¨æ„äº‹é¡¹**: 
  - å‚æ•°å¯èƒ½åŒ…å«JSONæ ¼å¼ï¼Œéœ€è¦è§£æå¤„ç†
  - å½“å‰å®ç°ä¸ºç¡¬ç¼–ç æ•°æ®ï¼Œå®é™…åº”æ¥å…¥æ•°æ®åº“æˆ–API
  - å¦‚æœå­¦å·ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºåˆ—è¡¨

### 4.4 å›¾ä¹¦é¦†åº§ä½æŸ¥è¯¢å·¥å…· (LibrarySeatTool.java)

**æ–‡ä»¶è·¯å¾„**: `src/main/java/top/wuhao/assistant/tool/LibrarySeatTool.java`

**å®Œæ•´ä»£ç **:
```java
package top.wuhao.assistant.tool;

import org.springframework.ai.chat.model.ToolContext;
import org.springframework.ai.tool.annotation.ToolParam;
import org.springframework.stereotype.Component;

import java.util.Random;
import java.util.function.BiFunction;

/**
 * @author mqxu
 * @date 2025/11/26
 * @description å›¾ä¹¦é¦†åº§ä½æŸ¥è¯¢å·¥å…·
 **/
@Component
public class LibrarySeatTool implements BiFunction<String, ToolContext, String> {
    
    @Override
    public String apply(
            @ToolParam(description = "å›¾ä¹¦é¦†åŒºåŸŸï¼Œå¦‚ï¼šAåŒºã€BåŒºã€CåŒº") String area,
            ToolContext toolContext) {
        
        Random random = new Random();
        int totalSeats = 200;
        // 20-170 ä¹‹é—´çš„éšæœºæ•°
        int occupied = random.nextInt(150) + 20;
        int available = totalSeats - occupied;
        
        return String.format(
            "{ \"area\": \"%s\", \"totalSeats\": %d, \"occupied\": %d, \"available\": %d, \"availabilityRate\": \"%.1f%%\" }",
            area, totalSeats, occupied, available, (available * 100.0 / totalSeats)
        );
    }
}
```

**åŠŸèƒ½è¯´æ˜**:
- **è¾“å…¥å‚æ•°**: å›¾ä¹¦é¦†åŒºåŸŸï¼ˆStringï¼‰ï¼Œå¦‚ï¼šAåŒºã€BåŒºã€CåŒº
- **è¿”å›ç±»å‹**: JSONæ ¼å¼çš„åº§ä½ä¿¡æ¯ï¼ˆStringï¼‰
- **è¿”å›æ•°æ®æ ¼å¼**:
  ```json
  {
    "area": "AåŒº",
    "totalSeats": 200,
    "occupied": 120,
    "available": 80,
    "availabilityRate": "40.0%"
  }
  ```
- **è§¦å‘æ¡ä»¶**: å½“ç”¨æˆ·è¯¢é—®å›¾ä¹¦é¦†ã€è‡ªä¹ ã€åº§ä½æ—¶ï¼ŒAgentä¼šè°ƒç”¨æ­¤å·¥å…·
- **å½“å‰å®ç°**: ä½¿ç”¨éšæœºæ•°æ¨¡æ‹Ÿåº§ä½å ç”¨æƒ…å†µ

### 4.5 æ ¡å›­ä¿¡æ¯å·¥å…· (CampusInfoTool.java)

**æ–‡ä»¶è·¯å¾„**: `src/main/java/top/wuhao/assistant/tool/CampusInfoTool.java`

**å®Œæ•´ä»£ç **:
```java
package top.wuhao.assistant.tool;

import org.springframework.ai.chat.model.ToolContext;
import org.springframework.ai.tool.annotation.ToolParam;
import org.springframework.stereotype.Component;

import java.util.function.BiFunction;

/**
 * @author mqxu
 * @date 2025/11/26
 * @description æ ¡å›­ä¿¡æ¯å·¥å…·ç±»
 * BiFunction çš„ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ª String ä»£è¡¨å…¥å‚ä¸ºå­—ç¬¦ä¸²ï¼Œä¸­é—´æ˜¯ä¸Šä¸‹æ–‡ï¼Œæœ€åçš„ String è¡¨ç¤ºè¿”å›ä¿¡æ¯æ˜¯å­—ç¬¦ä¸²
 **/
@Component
public class CampusInfoTool implements BiFunction<String, ToolContext, String> {
    
    @Override
    public String apply(
            @ToolParam(description = "å­¦ç”Ÿçš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šå›¾ä¹¦é¦†å¼€æ”¾æ—¶é—´ã€é£Ÿå ‚ä½ç½®ç­‰") String query,
            ToolContext toolContext) {
        
        // æ¨¡æ‹Ÿæ ¡å›­çŸ¥è¯†åº“
        if (query.contains("å›¾ä¹¦é¦†")) {
            return "å›¾ä¹¦é¦†åœ¨æ•™å­¦æ¥¼Aåº§æ—è¾¹ï¼Œå¼€æ”¾æ—¶é—´æ˜¯8:00-22:00ï¼Œå‘¨å…­æ—¥æ­£å¸¸å¼€æ”¾ã€‚";
        } else if (query.contains("é£Ÿå ‚")) {
            return "å­¦æ ¡æœ‰ä¸‰ä¸ªé£Ÿå ‚ï¼šç¬¬ä¸€é£Ÿå ‚åœ¨å®¿èˆåŒºï¼ˆ6:30-21:30ï¼‰ï¼Œç¬¬äºŒé£Ÿå ‚åœ¨ä½“è‚²é¦†æ—ï¼ˆ7:00-21:00ï¼‰ï¼Œç¬¬ä¸‰é£Ÿå ‚æ˜¯æ¸…çœŸé£Ÿå ‚ï¼ˆ7:00-20:30ï¼‰ã€‚";
        } else if (query.contains("æ•™åŠ¡å¤„")) {
            return "æ•™åŠ¡å¤„ä½äºè¡Œæ”¿æ¥¼3æ¥¼ï¼Œç”µè¯ï¼š010-12345678ã€‚";
        } else {
            return "æŠ±æ­‰ï¼Œæš‚æ—¶æ— æ³•å›ç­”è¿™ä¸ªé—®é¢˜ã€‚ä½ å¯ä»¥å’¨è¯¢å­¦æ ¡å®˜æ–¹å…¬ä¼—å·æˆ–æ‹¨æ‰“æ ¡å›­çƒ­çº¿010-12345678ã€‚";
        }
    }
}
```

**åŠŸèƒ½è¯´æ˜**:
- **è¾“å…¥å‚æ•°**: å­¦ç”Ÿçš„é—®é¢˜ï¼ˆStringï¼‰
- **è¿”å›ç±»å‹**: æ–‡æœ¬å›ç­”ï¼ˆStringï¼‰
- **çŸ¥è¯†åº“å†…å®¹**:
  - å›¾ä¹¦é¦†: ä½ç½®å’Œå¼€æ”¾æ—¶é—´
  - é£Ÿå ‚: ä¸‰ä¸ªé£Ÿå ‚çš„ä½ç½®å’Œå¼€æ”¾æ—¶é—´
  - æ•™åŠ¡å¤„: ä½ç½®å’Œè”ç³»ç”µè¯
  - å…¶ä»–: é»˜è®¤æç¤ºä¿¡æ¯
- **è§¦å‘æ¡ä»¶**: å½“ç”¨æˆ·è¯¢é—®æ ¡å›­ç›¸å…³ä¿¡æ¯æ—¶ï¼ŒAgentä¼šè°ƒç”¨æ­¤å·¥å…·
- **å½“å‰å®ç°**: åŸºäºå…³é”®è¯åŒ¹é…çš„ç®€å•é—®ç­”ï¼Œå¯æ‰©å±•ä¸ºå‘é‡æ£€ç´¢æˆ–çŸ¥è¯†å›¾è°±

---

## äº”ã€æ¥å£æ–‡æ¡£

### 5.1 åŸºç¡€ä¿¡æ¯

- **åŸºç¡€URL**: `http://localhost:8082`
- **APIç‰ˆæœ¬**: 
  - v1: ç®€å•æµ‹è¯•æ¥å£ï¼ˆæ— çŠ¶æ€ï¼‰
  - v2: é«˜çº§æ¥å£ï¼ˆæ”¯æŒå¤šè½®å¯¹è¯ï¼‰

### 5.2 API v1 - ç®€å•æµ‹è¯•æ¥å£

#### 5.2.1 ç®€å•å¯¹è¯æ¥å£

**æ¥å£ä¿¡æ¯**:
- **URL**: `/api/v1/chat`
- **è¯·æ±‚æ–¹å¼**: `GET`
- **æ¥å£æè¿°**: ç®€å•çš„å•æ¬¡å¯¹è¯æ¥å£ï¼Œä¸æ”¯æŒä¸Šä¸‹æ–‡è®°å¿†

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å   | ç±»å‹   | å¿…å¡« | é»˜è®¤å€¼         | è¯´æ˜       |
| -------- | ------ | ---- | -------------- | ---------- |
| question | String | å¦   | "å›¾ä¹¦é¦†åœ¨å“ªé‡Œ" | ç”¨æˆ·çš„é—®é¢˜ |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
# ä½¿ç”¨é»˜è®¤é—®é¢˜
curl http://localhost:8082/api/v1/chat

# æŒ‡å®šé—®é¢˜
curl "http://localhost:8082/api/v1/chat?question=ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·"
```

**å“åº”æ•°æ®**:

**å“åº”ç±»å‹**: `String` (çº¯æ–‡æœ¬)

**å“åº”ç¤ºä¾‹**:
```
ä»Šå¤©å—äº¬çš„å¤©æ°”æ˜¯æ™´å¤©ï¼Œæ¸©åº¦22Â°Cï¼Œé€‚åˆå‡ºè¡Œï¼Œå»ºè®®ç©¿é•¿è¢–ã€‚
```

**å“åº”è¯´æ˜**:
- è¿”å›Agentç”Ÿæˆçš„çº¯æ–‡æœ¬å›ç­”
- ä¸æ”¯æŒå¤šè½®å¯¹è¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„

---

### 5.3 API v2 - é«˜çº§æ¥å£

#### 5.3.1 æ™ºèƒ½å¯¹è¯æ¥å£

**æ¥å£ä¿¡æ¯**:
- **URL**: `/api/v2/chat`
- **è¯·æ±‚æ–¹å¼**: `POST`
- **Content-Type**: `application/json`
- **æ¥å£æè¿°**: æ”¯æŒå¤šè½®å¯¹è¯çš„æ™ºèƒ½å¯¹è¯æ¥å£ï¼Œå…·æœ‰ä¸Šä¸‹æ–‡è®°å¿†åŠŸèƒ½

**è¯·æ±‚å¤´**:
```
Content-Type: application/json
```

**è¯·æ±‚ä½“** (RequestDTO):

```json
{
  "userId": "string",    // ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼Œå¿…å¡«
  "message": "string"    // ç”¨æˆ·æ¶ˆæ¯å†…å®¹ï¼Œå¿…å¡«
}
```

**è¯·æ±‚å‚æ•°è¯´æ˜**:

| å‚æ•°å  | ç±»å‹   | å¿…å¡« | è¯´æ˜                                                         |
| ------- | ------ | ---- | ------------------------------------------------------------ |
| userId  | String | æ˜¯   | ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡ã€‚ç›¸åŒuserIdçš„è¯·æ±‚ä¼šå…±äº«åŒä¸€ä¸ªthreadId |
| message | String | æ˜¯   | ç”¨æˆ·å‘é€çš„æ¶ˆæ¯å†…å®¹                                           |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X POST http://localhost:8082/api/v2/chat \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "student001",
    "message": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
  }'
```

**JavaScriptç¤ºä¾‹**:
```javascript
const response = await fetch('http://localhost:8082/api/v2/chat', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        userId: 'student001',
        message: 'ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ'
    })
});

const data = await response.json();
console.log(data);
```

**å“åº”æ•°æ®** (AssistantResponse):

```json
{
  "userId": "string",           // ç”¨æˆ·IDï¼ˆå½“å‰æœªè®¾ç½®ï¼‰
  "threadId": "string",          // çº¿ç¨‹IDï¼ˆå½“å‰æœªè®¾ç½®ï¼‰
  "answer": "string",            // Agentçš„å›ç­”å†…å®¹
  "suggestion": "string",        // ç›¸å…³å»ºè®®
  "type": "string",              // å›ç­”ç±»å‹ï¼šweather/course/library/general
  "needsFurtherHelp": boolean    // æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥å¸®åŠ©
}
```

**å“åº”å‚æ•°è¯´æ˜**:

| å‚æ•°å           | ç±»å‹    | è¯´æ˜                                                         |
| ---------------- | ------- | ------------------------------------------------------------ |
| userId           | String  | ç”¨æˆ·IDï¼ˆå½“å‰å®ç°ä¸­æœªè®¾ç½®ï¼‰                                   |
| threadId         | String  | çº¿ç¨‹IDï¼Œç”¨äºç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆå½“å‰å®ç°ä¸­æœªè®¾ç½®ï¼‰               |
| answer           | String  | Agentç”Ÿæˆçš„ä¸»è¦å›ç­”å†…å®¹                                      |
| suggestion       | String  | ç›¸å…³å»ºè®®ï¼ˆå½“å‰ä¸ºå›ºå®šå€¼ï¼‰                                     |
| type             | String  | å›ç­”ç±»å‹ï¼šweather(å¤©æ°”)/course(è¯¾ç¨‹)/library(å›¾ä¹¦é¦†)/general(é€šç”¨) |
| needsFurtherHelp | Boolean | æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥å¸®åŠ©ï¼ˆå½“å‰ä¸ºfalseï¼‰                            |

**å“åº”ç¤ºä¾‹**:

**åœºæ™¯1: æŸ¥è¯¢å¤©æ°”**
```json
{
  "userId": null,
  "threadId": null,
  "answer": "ä»Šå¤©å—äº¬çš„å¤©æ°”æ˜¯æ™´å¤©ï¼Œæ¸©åº¦22Â°Cï¼Œé€‚åˆå‡ºè¡Œï¼Œå»ºè®®ç©¿é•¿è¢–ã€‚",
  "suggestion": "è¯·æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œç»™å‡ºä¸€ä¸ªå»ºè®®",
  "type": "general",
  "needsFurtherHelp": false
}
```

**åœºæ™¯2: æŸ¥è¯¢è¯¾ç¨‹ï¼ˆéœ€è¦å­¦å·ï¼‰**
```json
{
  "userId": null,
  "threadId": null,
  "answer": "è¦æŸ¥è¯¢æ‚¨çš„è¯¾ç¨‹è¡¨ï¼Œæˆ‘éœ€è¦æ‚¨çš„å­¦å·ã€‚è¯·è¾“å…¥å­¦å·ï¼Œä¾‹å¦‚ï¼šè¾“å…¥å­¦å·20220001ï¼ŒæŸ¥è¯¢è¯¾è¡¨",
  "suggestion": "è¯·æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œç»™å‡ºä¸€ä¸ªå»ºè®®",
  "type": "general",
  "needsFurtherHelp": false
}
```

**åœºæ™¯3: æŸ¥è¯¢è¯¾ç¨‹ï¼ˆå·²æä¾›å­¦å·ï¼‰**
```json
{
  "userId": null,
  "threadId": null,
  "answer": "æ ¹æ®æ‚¨çš„å­¦å·20220001ï¼Œæ‚¨ä»Šå¤©çš„è¯¾ç¨‹å®‰æ’å¦‚ä¸‹ï¼š\n1. Spring Boot - 08:00-09:40 - æ•™å››319\n2. Spring AI - 13:30-15:10 - æ•™å››419",
  "suggestion": "è¯·æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œç»™å‡ºä¸€ä¸ªå»ºè®®",
  "type": "general",
  "needsFurtherHelp": false
}
```

**åœºæ™¯4: æŸ¥è¯¢å›¾ä¹¦é¦†åº§ä½**
```json
{
  "userId": null,
  "threadId": null,
  "answer": "å›¾ä¹¦é¦†AåŒºå½“å‰æœ‰200ä¸ªåº§ä½ï¼Œå…¶ä¸­å·²å ç”¨120ä¸ªï¼Œè¿˜æœ‰80ä¸ªç©ºåº§ä½ï¼Œç©ºåº§ç‡ä¸º40.0%ã€‚",
  "suggestion": "è¯·æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œç»™å‡ºä¸€ä¸ªå»ºè®®",
  "type": "general",
  "needsFurtherHelp": false
}
```

**å¤šè½®å¯¹è¯ç¤ºä¾‹**:

```bash
# ç¬¬ä¸€è½®ï¼šè¯¢é—®å¤©æ°”
curl -X POST http://localhost:8082/api/v2/chat \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "student003",
    "message": "ä»Šå¤©å—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
  }'

# ç¬¬äºŒè½®ï¼šç»§ç»­è¯¢é—®ï¼ˆAgentä¼šè®°ä½ä¸Šä¸‹æ–‡ï¼‰
curl -X POST http://localhost:8082/api/v2/chat \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "student003",
    "message": "é‚£æ˜å¤©å‘¢ï¼Ÿ"
  }'
```

**é”™è¯¯å¤„ç†**:

å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œä¼šè¿”å›HTTP 500é”™è¯¯ï¼Œå“åº”ä½“å¯èƒ½åŒ…å«é”™è¯¯ä¿¡æ¯ã€‚

---

#### 5.3.2 æŸ¥è¯¢å†å²è®°å½•æ¥å£

**æ¥å£ä¿¡æ¯**:
- **URL**: `/api/v2/history/{userId}`
- **è¯·æ±‚æ–¹å¼**: `GET`
- **æ¥å£æè¿°**: æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„å†å²å¯¹è¯è®°å½•ï¼ˆå½“å‰ä¸ºç®€åŒ–å®ç°ï¼‰

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹   | å¿…å¡« | è¯´æ˜         |
| ------ | ------ | ---- | ------------ |
| userId | String | æ˜¯   | ç”¨æˆ·å”¯ä¸€æ ‡è¯† |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X GET http://localhost:8082/api/v2/history/student003
```

**å“åº”æ•°æ®**:

**æˆåŠŸå“åº”**:
```json
{
  "userId": "student003",
  "threadId": "550e8400-e29b-41d4-a716-446655440000",
  "history": "å†å²è®°å½•åŠŸèƒ½éœ€è¦è¿›ä¸€æ­¥å®ç°"
}
```

**å¤±è´¥å“åº”** (ç”¨æˆ·ä¸å­˜åœ¨):
```json
{
  "error": "æœªæ‰¾åˆ°è¯¥ç”¨æˆ·çš„å†å²è®°å½•"
}
```

**å“åº”å‚æ•°è¯´æ˜**:

| å‚æ•°å   | ç±»å‹   | è¯´æ˜                         |
| -------- | ------ | ---------------------------- |
| userId   | String | ç”¨æˆ·ID                       |
| threadId | String | çº¿ç¨‹ID                       |
| history  | String | å†å²è®°å½•ï¼ˆå½“å‰ä¸ºå ä½æ–‡æœ¬ï¼‰   |
| error    | String | é”™è¯¯ä¿¡æ¯ï¼ˆä»…å½“ç”¨æˆ·ä¸å­˜åœ¨æ—¶ï¼‰ |

**æ³¨æ„äº‹é¡¹**:
- å½“å‰å®ç°ä¸ºç®€åŒ–ç‰ˆæœ¬ï¼Œä»…è¿”å›ç”¨æˆ·IDå’Œçº¿ç¨‹ID
- å®é™…çš„å†å²è®°å½•åŠŸèƒ½éœ€è¦è¿›ä¸€æ­¥å®ç°
- éœ€è¦ä»MemorySaverä¸­è·å–å®Œæ•´çš„å¯¹è¯å†å²

---

## å…­ã€æ•°æ®æ¨¡å‹

### 6.1 è¯·æ±‚æ¨¡å‹ (RequestDTO)

**æ–‡ä»¶è·¯å¾„**: `src/main/java/top/wuhao/assistant/model/RequestDTO.java`

**å®Œæ•´ä»£ç **:
```java
package top.wuhao.assistant.model;

import lombok.Data;

/**
 * @author
 * @description è¯·æ±‚ AI Agent çš„æ•°æ®ä¼ è¾“å¯¹è±¡
 */
@Data
public class RequestDTO {
    /**
     * ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼ˆç”¨äºç”Ÿæˆ threadIdï¼‰
     */
    private String userId;

    /**
     * ç”¨æˆ·å‘é€çš„æ¶ˆæ¯å†…å®¹
     */
    private String message;
}
```

**å­—æ®µè¯´æ˜**:

| å­—æ®µå  | ç±»å‹   | å¿…å¡« | è¯´æ˜                                                         |
| ------- | ------ | ---- | ------------------------------------------------------------ |
| userId  | String | æ˜¯   | ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡ã€‚ç›¸åŒuserIdä¼šå…±äº«åŒä¸€ä¸ªthreadId |
| message | String | æ˜¯   | ç”¨æˆ·å‘é€çš„æ¶ˆæ¯å†…å®¹                                           |

**JSONç¤ºä¾‹**:
```json
{
  "userId": "student001",
  "message": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
}
```

### 6.2 å“åº”æ¨¡å‹ (AssistantResponse)

**æ–‡ä»¶è·¯å¾„**: `src/main/java/top/wuhao/assistant/model/AssistantResponse.java`

**å®Œæ•´ä»£ç **:
```java
package top.wuhao.assistant.model;

import lombok.Data;

/**
 * @author mqxu
 * @date 2025/11/26
 * @description ç»“æ„åŒ–è¾“å‡ºç±»
 **/
@Data
public class AssistantResponse {
    // ç”¨æˆ·id
    private String userId;
    // çº¿ç¨‹id
    private String threadId;
    // ä¸»è¦å›ç­”å†…å®¹
    private String answer;
    // ç›¸å…³å»ºè®®
    private String suggestion;
    // å›ç­”ç±»å‹ï¼šweather/course/library/general
    private String type;
    // æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥å¸®åŠ©
    private boolean needsFurtherHelp;
}
```

**å­—æ®µè¯´æ˜**:

| å­—æ®µå           | ç±»å‹    | è¯´æ˜                                                         |
| ---------------- | ------- | ------------------------------------------------------------ |
| userId           | String  | ç”¨æˆ·IDï¼ˆå½“å‰å®ç°ä¸­æœªè®¾ç½®ï¼‰                                   |
| threadId         | String  | çº¿ç¨‹IDï¼Œç”¨äºç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆå½“å‰å®ç°ä¸­æœªè®¾ç½®ï¼‰               |
| answer           | String  | Agentç”Ÿæˆçš„ä¸»è¦å›ç­”å†…å®¹                                      |
| suggestion       | String  | ç›¸å…³å»ºè®®ï¼ˆå½“å‰ä¸ºå›ºå®šå€¼ï¼š"è¯·æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œç»™å‡ºä¸€ä¸ªå»ºè®®"ï¼‰     |
| type             | String  | å›ç­”ç±»å‹ï¼šweather(å¤©æ°”)/course(è¯¾ç¨‹)/library(å›¾ä¹¦é¦†)/general(é€šç”¨) |
| needsFurtherHelp | Boolean | æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥å¸®åŠ©ï¼ˆå½“å‰ä¸ºfalseï¼‰                            |

**JSONç¤ºä¾‹**:
```json
{
  "userId": null,
  "threadId": null,
  "answer": "ä»Šå¤©å—äº¬çš„å¤©æ°”æ˜¯æ™´å¤©ï¼Œæ¸©åº¦22Â°Cï¼Œé€‚åˆå‡ºè¡Œï¼Œå»ºè®®ç©¿é•¿è¢–ã€‚",
  "suggestion": "è¯·æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œç»™å‡ºä¸€ä¸ªå»ºè®®",
  "type": "general",
  "needsFurtherHelp": false
}
```

### 6.3 è¯¾ç¨‹æ¨¡å‹ (Course)

**æ–‡ä»¶è·¯å¾„**: `src/main/java/top/wuhao/assistant/tool/CourseQueryTool.java` (å†…éƒ¨ç±»)

**å®Œæ•´ä»£ç **:
```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public static class Course {
    private String name;      // è¯¾ç¨‹åç§°
    private String time;      // ä¸Šè¯¾æ—¶é—´
    private String location;  // ä¸Šè¯¾åœ°ç‚¹
}
```

**å­—æ®µè¯´æ˜**:

| å­—æ®µå   | ç±»å‹   | è¯´æ˜                        |
| -------- | ------ | --------------------------- |
| name     | String | è¯¾ç¨‹åç§°                    |
| time     | String | ä¸Šè¯¾æ—¶é—´ï¼Œæ ¼å¼ï¼šHH:mm-HH:mm |
| location | String | ä¸Šè¯¾åœ°ç‚¹                    |

**JSONç¤ºä¾‹**:
```json
{
  "name": "Spring Boot",
  "time": "08:00-09:40",
  "location": "æ•™å››319"
}
```

---

## ä¸ƒã€ä½¿ç”¨ç¤ºä¾‹

### 7.1 å¯åŠ¨åº”ç”¨

```bash
# æ–¹å¼1: ä½¿ç”¨Maven
mvn spring-boot:run

# æ–¹å¼2: æ‰“åŒ…åè¿è¡Œ
mvn clean package
java -jar target/campus-assistant-0.0.1-SNAPSHOT.jar
```

åº”ç”¨å¯åŠ¨åï¼Œè®¿é—®åœ°å€: `http://localhost:8082`

### 7.2 æµ‹è¯•åœºæ™¯

#### åœºæ™¯1: æŸ¥è¯¢å¤©æ°”

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:8082/api/v2/chat \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "student001",
    "message": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
  }'
```

**é¢„æœŸå“åº”**:
```json
{
  "answer": "ä»Šå¤©å—äº¬çš„å¤©æ°”æ˜¯æ™´å¤©ï¼Œæ¸©åº¦22Â°Cï¼Œé€‚åˆå‡ºè¡Œï¼Œå»ºè®®ç©¿é•¿è¢–ã€‚",
  "type": "general",
  "suggestion": "è¯·æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œç»™å‡ºä¸€ä¸ªå»ºè®®",
  "needsFurtherHelp": false
}
```

#### åœºæ™¯2: æŸ¥è¯¢è¯¾ç¨‹ï¼ˆé¦–æ¬¡è¯¢é—®ï¼‰

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:8082/api/v2/chat \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "student001",
    "message": "æŸ¥è¯¢æˆ‘çš„è¯¾è¡¨"
  }'
```

**é¢„æœŸå“åº”**:
```json
{
  "answer": "è¦æŸ¥è¯¢æ‚¨çš„è¯¾ç¨‹è¡¨ï¼Œæˆ‘éœ€è¦æ‚¨çš„å­¦å·ã€‚è¯·è¾“å…¥å­¦å·ï¼Œä¾‹å¦‚ï¼šè¾“å…¥å­¦å·20220001ï¼ŒæŸ¥è¯¢è¯¾è¡¨",
  "type": "general",
  "suggestion": "è¯·æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œç»™å‡ºä¸€ä¸ªå»ºè®®",
  "needsFurtherHelp": false
}
```

#### åœºæ™¯3: æŸ¥è¯¢è¯¾ç¨‹ï¼ˆæä¾›å­¦å·ï¼‰

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:8082/api/v2/chat \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "student001",
    "message": "è¾“å…¥å­¦å·20220001ï¼ŒæŸ¥è¯¢è¯¾è¡¨"
  }'
```

**é¢„æœŸå“åº”**:
```json
{
  "answer": "æ ¹æ®æ‚¨çš„å­¦å·20220001ï¼Œæ‚¨ä»Šå¤©çš„è¯¾ç¨‹å®‰æ’å¦‚ä¸‹ï¼š\n1. Spring Boot - 08:00-09:40 - æ•™å››319\n2. Spring AI - 13:30-15:10 - æ•™å››419",
  "type": "general",
  "suggestion": "è¯·æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œç»™å‡ºä¸€ä¸ªå»ºè®®",
  "needsFurtherHelp": false
}
```

#### åœºæ™¯4: å¤šè½®å¯¹è¯

**ç¬¬ä¸€è½®**:
```bash
curl -X POST http://localhost:8082/api/v2/chat \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "student003",
    "message": "ä»Šå¤©å—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
  }'
```

**ç¬¬äºŒè½®**ï¼ˆAgentä¼šè®°ä½ä¸Šä¸‹æ–‡ï¼‰:
```bash
curl -X POST http://localhost:8082/api/v2/chat \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "student003",
    "message": "é‚£æ˜å¤©å‘¢ï¼Ÿ"
  }'
```

### 7.3 å‰ç«¯é›†æˆç¤ºä¾‹

**HTMLé¡µé¢** (`src/main/resources/static/chat.html`):

```html
<!DOCTYPE html>
<html lang="zh">
<head>
    <title>æ ¡å›­æ™ºèƒ½åŠ©æ‰‹</title>
    <meta charset="UTF-8"/>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
        }
        #chat {
            border: 1px solid #ccc;
            height: 500px;
            padding: 20px;
            overflow-y: scroll;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .user {
            background: #e3f2fd;
            text-align: right;
        }
        .bot {
            background: #f1f8e9;
        }
        #input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<h1>ğŸ“ æ ¡å›­æ™ºèƒ½åŠ©æ‰‹ "å°æ¤°"</h1>
<div id="chat"></div>
<input id="input" placeholder="è¾“å…¥ä½ çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ">

<script>
    const userId = 'user_' + Math.random().toString(36).substr(2, 9);
    const chat = document.getElementById('chat');
    const input = document.getElementById('input');

    input.addEventListener('keypress', async (e) => {
        if (e.key === 'Enter' && input.value.trim()) {
            const message = input.value.trim();
            addMessage(message, 'user');
            input.value = '';

            const response = await fetch('http://localhost:8082/api/v2/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({userId, message})
            });

            const data = await response.json();
            addMessage(data.answer, 'bot');
        }
    });

    function addMessage(text, sender) {
        const div = document.createElement('div');
        div.className = `message ${sender}`;
        div.textContent = text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }
</script>
</body>
</html>
```

è®¿é—®åœ°å€: `http://localhost:8082/chat.html`

---

## å…«ã€Agenté…ç½®è¯¦è§£

### 8.1 Agenté…ç½®ç±» (AgentConfig.java)

**æ–‡ä»¶è·¯å¾„**: `src/main/java/top/wuhao/assistant/config/AgentConfig.java`

**æ ¸å¿ƒé…ç½®è¯´æ˜**:

1. **DashScopeApi Bean**: é…ç½®DashScope APIå®¢æˆ·ç«¯
2. **DashScopeChatModel Bean**: é…ç½®èŠå¤©æ¨¡å‹
3. **ToolCallback Beans**: å°†å·¥å…·ç±»å°è£…ä¸ºToolCallbackï¼Œä¾›Agentè°ƒç”¨
4. **ReactAgent Bean**: é…ç½®ReActæ¨¡å¼çš„Agentï¼Œé›†æˆæ‰€æœ‰å·¥å…·

**System Prompt**:
```
ä½ æ˜¯ä¸€ä¸ªè´´å¿ƒçš„æ ¡å›­æ™ºèƒ½åŠ©æ‰‹"å°æ¤°"ï¼Œä¸“é—¨æœåŠ¡å¤§å­¦ç”Ÿç¾¤ä½“ã€‚

ä½ çš„èŒè´£åŒ…æ‹¬ï¼š
1. æŸ¥è¯¢å¤©æ°”ä¿¡æ¯ï¼Œå¸®åŠ©å­¦ç”Ÿå†³å®šç©¿è¡£å’Œå‡ºè¡Œ
2. æŸ¥è¯¢è¯¾ç¨‹è¡¨ï¼Œæé†’å­¦ç”Ÿä¸Šè¯¾æ—¶é—´åœ°ç‚¹
3. æŸ¥è¯¢å›¾ä¹¦é¦†åº§ä½æƒ…å†µï¼Œå¸®åŠ©å­¦ç”Ÿæ‰¾åˆ°è‡ªä¹ ä½ç½®
4. å›ç­”å„ç±»æ ¡å›­ç”Ÿæ´»é—®é¢˜

è¡Œä¸ºå‡†åˆ™ï¼š
- ä½¿ç”¨è½»æ¾å‹å¥½çš„è¯­æ°”ï¼Œåƒå­¦é•¿å­¦å§ä¸€æ ·äº²åˆ‡
- å›ç­”è¦å…·ä½“å®ç”¨ï¼Œä¸è¦ç©ºæ³›
- ä¸»åŠ¨æä¾›ç›¸å…³å»ºè®®
- ä¸ç¡®å®šçš„ä¿¡æ¯è¦è¯´æ˜æ¸…æ¥š
- é€‚å½“ä½¿ç”¨ emoji è®©å¯¹è¯æ›´ç”ŸåŠ¨

å·¥å…·ä½¿ç”¨è§„åˆ™ï¼š
- æŸ¥è¯¢å¤©æ°”ï¼šå½“å­¦ç”Ÿæåˆ°å¤©æ°”ã€æ¸©åº¦ã€ç©¿è¡£å»ºè®®æ—¶ä½¿ç”¨ getWeather å·¥å…·
- æŸ¥è¯¢è¯¾ç¨‹ï¼šå½“å­¦ç”Ÿé—®è¯¾ç¨‹ã€è¯¾è¡¨ã€ä¸Šè¯¾åœ°ç‚¹æ—¶ä½¿ç”¨ getCourseInfo å·¥å…·ï¼ˆéœ€è¦å­¦å·ï¼‰
- æŸ¥è¯¢å›¾ä¹¦é¦†ï¼šå½“å­¦ç”Ÿé—®å›¾ä¹¦é¦†ã€è‡ªä¹ ã€åº§ä½æ—¶ä½¿ç”¨ getLibrarySeat å·¥å…·
- æ ¡å›­ä¿¡æ¯ï¼šå…¶ä»–æ ¡å›­ç›¸å…³é—®é¢˜ä½¿ç”¨ getCampusInfo å·¥å…·
```

---

## ä¹ã€å¸¸è§é—®é¢˜

### 9.1 APIå¯†é’¥é…ç½®

**é—®é¢˜**: å¦‚ä½•é…ç½®DashScope APIå¯†é’¥ï¼Ÿ

**è§£ç­”**: 
1. ä»ç¯å¢ƒå˜é‡è·å–ï¼ˆæ¨èï¼‰:
   ```bash
   export AI_DASHSCOPE_API_KEY=ä½ çš„api_key
   ```
2. åœ¨application.ymlä¸­ç›´æ¥é…ç½®ï¼ˆä¸æ¨èï¼Œå®‰å…¨æ€§ä½ï¼‰

### 9.2 å¤šè½®å¯¹è¯ä¸ç”Ÿæ•ˆ

**é—®é¢˜**: ä¸ºä»€ä¹ˆå¤šè½®å¯¹è¯æ—¶Agentä¸è®°å¾—ä¹‹å‰çš„å¯¹è¯ï¼Ÿ

**è§£ç­”**: 
- ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„`userId`
- ç¡®ä¿ä½¿ç”¨`/api/v2/chat`æ¥å£ï¼ˆv1æ¥å£ä¸æ”¯æŒå¤šè½®å¯¹è¯ï¼‰
- æ£€æŸ¥`threadId`æ˜¯å¦æ­£ç¡®ç»´æŠ¤

### 9.3 å·¥å…·æœªè¢«è°ƒç”¨

**é—®é¢˜**: Agentæ²¡æœ‰è°ƒç”¨é¢„æœŸçš„å·¥å…·ï¼Ÿ

**è§£ç­”**:
- æ£€æŸ¥System Promptä¸­çš„å·¥å…·ä½¿ç”¨è§„åˆ™æ˜¯å¦æ¸…æ™°
- æ£€æŸ¥å·¥å…·çš„æè¿°ï¼ˆdescriptionï¼‰æ˜¯å¦å‡†ç¡®
- æ£€æŸ¥ç”¨æˆ·é—®é¢˜æ˜¯å¦æ˜ç¡®è§¦å‘äº†å·¥å…·ä½¿ç”¨æ¡ä»¶

### 9.4 è¯¾ç¨‹æŸ¥è¯¢è¿”å›ç©º

**é—®é¢˜**: æŸ¥è¯¢è¯¾ç¨‹æ—¶è¿”å›ç©ºåˆ—è¡¨ï¼Ÿ

**è§£ç­”**:
- æ£€æŸ¥å­¦å·æ˜¯å¦æ­£ç¡®ï¼ˆå½“å‰æ”¯æŒ20220001å’Œ20220002ï¼‰
- æ£€æŸ¥å‚æ•°è§£ææ˜¯å¦æ­£ç¡®ï¼ˆå¯èƒ½åŒ…å«JSONæ ¼å¼ï¼‰

---

## åã€æ‰©å±•å»ºè®®

1. **æ¥å…¥çœŸå®API**: å°†å¤©æ°”ã€è¯¾ç¨‹ç­‰å·¥å…·æ¥å…¥çœŸå®çš„æ•°æ®æº
2. **å®Œå–„å†å²è®°å½•**: å®ç°å®Œæ•´çš„å†å²è®°å½•æŸ¥è¯¢åŠŸèƒ½
3. **ç”¨æˆ·è®¤è¯**: é›†æˆSpring Securityå®ç°ç”¨æˆ·ç™»å½•
4. **å“åº”ç±»å‹è¯†åˆ«**: æ ¹æ®å·¥å…·è°ƒç”¨ç»“æœè‡ªåŠ¨è®¾ç½®`type`å­—æ®µ
5. **é”™è¯¯å¤„ç†**: å®Œå–„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯å“åº”
6. **ç¼“å­˜ä¼˜åŒ–**: æ·»åŠ Redisç¼“å­˜å¸¸ç”¨æ•°æ®
7. **æ—¥å¿—ç›‘æ§**: æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•å’Œç›‘æ§

---

## åä¸€ã€ç‰ˆæœ¬ä¿¡æ¯

- **é¡¹ç›®ç‰ˆæœ¬**: 0.0.1-SNAPSHOT
- **Spring Bootç‰ˆæœ¬**: 3.5.7
- **Spring AI Alibabaç‰ˆæœ¬**: 1.1.0.0-M5
- **æ–‡æ¡£ç‰ˆæœ¬**: 1.0
- **æœ€åæ›´æ–°**: 2025-11-28

---

**æ–‡æ¡£ç»´æŠ¤**: å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚
```

è¯·å°†ä»¥ä¸Šå†…å®¹ä¿å­˜ä¸º `æ ¡å›­æ™ºèƒ½åŠ©æ‰‹ç¼–ç¨‹æ–‡æ¡£.md`ï¼Œæ”¾åœ¨ä¸ `ç®€æ˜“æ ¡å›­æ™ºèƒ½åŠ©æ‰‹å¼€å‘æ•™ç¨‹.md` åŒçº§ç›®å½•ã€‚æ–‡æ¡£åŒ…å«ï¼š
- é…ç½®æ–‡ä»¶ï¼ˆpom.xmlã€application.ymlï¼‰
- å·¥å…·ç±»è¯´æ˜ä¸ä»£ç 
- æ¥å£æ–‡æ¡£ï¼ˆURLã€è¯·æ±‚æ–¹å¼ã€è¯·æ±‚/å“åº”æ•°æ®æ ¼å¼ï¼‰
- æ•°æ®æ¨¡å‹
- ä½¿ç”¨ç¤ºä¾‹ä¸å¸¸è§é—®é¢˜

å¦‚éœ€è°ƒæ•´ï¼Œè¯·å‘ŠçŸ¥ã€‚